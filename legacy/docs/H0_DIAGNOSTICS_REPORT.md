# H0 - Диагностика отчёт

## Найденные проблемы

### 1. API эндпоинты
- `/api/horoscope` - возвращает только простой текст вместо структурированных данных
- `/api/horoscope/full` - требует обязательные поля birth (date, time, lat, lon, tzOffset), но страница не всегда их передаёт
- Нет валидации входных данных с дружелюбными ошибками
- Отсутствует обработка случая когда нет профиля

### 2. Страница /horoscope
- Пытается загрузить данные через activeChart, но если карты нет - ничего не показывает
- Нет обработки состояний загрузки/ошибки/пустых данных
- UI показывает пустые блоки при отсутствии данных

### 3. Главная страница
- Загружает много данных (профиль, карту, гороскоп), но не показывает ошибки
- Нет индикации загрузки
- При отсутствии данных показывает пустую карту

### 4. Отсутствие логирования
- Нет debug информации в консоли
- Нет трассировки ошибок
- Нет индикации кэш-хитов

### 5. Отсутствие mock-режима
- При падении внешних сервисов приложение не работает
- Нет возможности тестировать без реальных данных

## Внесённые изменения

### 1. Добавлено логирование
- Создан `/src/lib/api/logger.ts` с функциями логирования
- Все API запросы теперь логируют start/success/error с временем выполнения
- Добавлены debug headers: `x-debug-id`, `x-cache-hit`

### 2. Добавлен MOCK_MODE
- Создан `/src/lib/api/mocks.ts` с примерами данных
- API эндпоинты проверяют `MOCK_MODE=true` в env
- При ошибках возвращаются структурированные моковые данные

### 3. Обновлены API эндпоинты
- `/api/horoscope/route.ts` - добавлено логирование и mock-режим
- `/api/horoscope/full/route.ts` - добавлено логирование, кэш-хиты и mock-режим

## Что осталось сделать в следующих блоках
- H1: Нормализация входов API, валидация Zod, структурированный контент
- H2: Система читабельных текстов
- H3: Редизайн UI
- H4: Обработка состояний (skeleton, empty, error)
- H5: Реальные фикстуры
- H6: Тесты