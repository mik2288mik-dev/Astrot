// –ê–Ω–∞–ª–∏–∑ –¥–æ–º–æ–≤ - —Å—Ñ–µ—Ä—ã –∂–∏–∑–Ω–∏ –≤ —Ñ–æ–∫—É—Å–µ
// –ì–¥–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –ø–ª–∞–Ω–µ—Ç—ã

import type { ChartData } from '../../types';

export function analyzeHouses(chartData: ChartData) {
  const items: string[] = [];
  const highlights: Array<{ tag: 'strength' | 'risk' | 'advice'; text: string }> = [];

  // –°—á–∏—Ç–∞–µ–º –ø–ª–∞–Ω–µ—Ç—ã –≤ –∫–∞–∂–¥–æ–º –¥–æ–º–µ
  const housePlanetCounts = countPlanetsInHouses(chartData.planets);
  
  // –ù–∞—Ö–æ–¥–∏–º –¥–æ–º–∞ —Å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ–º –ø–ª–∞–Ω–µ—Ç (2+ –ø–ª–∞–Ω–µ—Ç—ã)
  const emphasizedHouses = Object.entries(housePlanetCounts)
    .filter(([, count]) => count >= 2)
    .sort(([, a], [, b]) => b - a)
    .slice(0, 3); // –ë–µ—Ä–µ–º —Ç–æ–ø-3

  if (emphasizedHouses.length === 0) {
    // –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∞–∂–Ω—ã–µ –æ–¥–∏–Ω–æ—á–Ω—ã–µ –ø–ª–∞–Ω–µ—Ç—ã
    const importantPlacements = analyzeImportantPlacements(chartData.planets);
    items.push(...importantPlacements.items);
    highlights.push(...importantPlacements.highlights);
    
    return {
      items,
      highlights,
      tip: '–í–∞—à–∏ –ø–ª–∞–Ω–µ—Ç—ã —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã - —É –≤–∞—Å —Ä–∞–∑–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã.'
    };
  }

  // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π –¥–æ–º
  emphasizedHouses.forEach(([houseStr, count]) => {
    const house = parseInt(houseStr);
    const analysis = getHouseAnalysis(house, count, chartData.planets);
    
    items.push(`${getHouseIcon(house)} ${analysis.title}`);
    items.push(analysis.description);
    
    if (analysis.strength) {
      highlights.push({ tag: 'strength', text: analysis.strength });
    }
    
    if (analysis.advice) {
      highlights.push({ tag: 'advice', text: analysis.advice });
    }
  });

  // –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–ª–∞–Ω–µ—Ç
  const distributionPattern = analyzeDistribution(housePlanetCounts);
  if (distributionPattern) {
    items.push(`üìä ${distributionPattern.description}`);
    if (distributionPattern.highlight) {
      highlights.push({ tag: distributionPattern.highlight.tag, text: distributionPattern.highlight.text });
    }
  }

  return {
    items,
    highlights,
    tip: '–î–æ–º–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–ª–∞–Ω–µ—Ç–∞–º–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤–∞—à–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ç–µ–º—ã –∏ –æ–±–ª–∞—Å—Ç–∏ —Ä–∞–∑–≤–∏—Ç–∏—è.'
  };
}

function countPlanetsInHouses(planets: ChartData['planets']) {
  const counts: Record<number, number> = {};
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –¥–æ–º–∞
  for (let i = 1; i <= 12; i++) {
    counts[i] = 0;
  }
  
  // –°—á–∏—Ç–∞–µ–º –ø–ª–∞–Ω–µ—Ç—ã –≤ –∫–∞–∂–¥–æ–º –¥–æ–º–µ
  planets.forEach(planet => {
    if (planet.house && planet.house >= 1 && planet.house <= 12) {
      counts[planet.house]++;
    }
  });
  
  return counts;
}

function analyzeImportantPlacements(planets: ChartData['planets']) {
  const items: string[] = [];
  const highlights: Array<{ tag: 'strength' | 'risk' | 'advice'; text: string }> = [];

  // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∞–∂–Ω—ã–µ –ø–ª–∞–Ω–µ—Ç—ã –≤ –≤–∞–∂–Ω—ã—Ö –¥–æ–º–∞—Ö
  const importantPlanets = ['Sun', 'Moon', 'Mercury', 'Venus', 'Mars'];
  const importantHouses = [1, 4, 7, 10]; // –£–≥–ª–æ–≤—ã–µ –¥–æ–º–∞

  importantPlanets.forEach(planetName => {
    const planet = planets.find(p => p.name === planetName);
    if (planet?.house && importantHouses.includes(planet.house)) {
      const analysis = getImportantPlacement(planetName, planet.house);
      items.push(`${getHouseIcon(planet.house)} ${analysis.description}`);
      if (analysis.highlight) {
        highlights.push({ tag: analysis.highlight.tag, text: analysis.highlight.text });
      }
    }
  });

  return { items, highlights };
}

function getImportantPlacement(planet: string, house: number) {
  const placements: Record<string, Record<number, { description: string; highlight?: { tag: 'strength' | 'advice'; text: string } }>> = {
    Sun: {
      1: { 
        description: '–°–æ–ª–Ω—Ü–µ –≤ 1 –¥–æ–º–µ: –í—ã —è—Ä–∫–∞—è, —Ö–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω–∞—è –ª–∏—á–Ω–æ—Å—Ç—å —Å —Å–∏–ª—å–Ω–æ–π –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ—Å—Ç—å—é.',
        highlight: { tag: 'strength', text: '–í–∞—à–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ö–∞—Ä–∏–∑–º–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–Ω–æ–≥–∏–µ –¥–≤–µ—Ä–∏.' }
      },
      4: { 
        description: '–°–æ–ª–Ω—Ü–µ –≤ 4 –¥–æ–º–µ: –°–µ–º—å—è –∏ –¥–æ–º –∏–≥—Ä–∞—é—Ç —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é —Ä–æ–ª—å –≤ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏.',
        highlight: { tag: 'advice', text: '–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫—Ä–µ–ø–∫—É—é –¥–æ–º–∞—à–Ω—é—é –±–∞–∑—É - —ç—Ç–æ –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–∞—à–µ–π —Å–∏–ª—ã.' }
      },
      7: { 
        description: '–°–æ–ª–Ω—Ü–µ –≤ 7 –¥–æ–º–µ: –û—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ - –∫–ª—é—á–µ–≤–∞—è —Ç–µ–º–∞ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏.',
        highlight: { tag: 'advice', text: '–£—á–∏—Ç–µ—Å—å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ —Å –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è–º–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞.' }
      },
      10: { 
        description: '–°–æ–ª–Ω—Ü–µ –≤ 10 –¥–æ–º–µ: –ö–∞—Ä—å–µ—Ä–∞ –∏ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –æ—á–µ–Ω—å –≤–∞–∂–Ω—ã –¥–ª—è –≤–∞—Å.',
        highlight: { tag: 'strength', text: '–£ –≤–∞—Å –µ—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è –∑–Ω–∞—á–∏–º—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –≤ –∫–∞—Ä—å–µ—Ä–µ.' }
      }
    },
    Moon: {
      1: { 
        description: '–õ—É–Ω–∞ –≤ 1 –¥–æ–º–µ: –í–∞—à–∏ —ç–º–æ—Ü–∏–∏ –∏ –∏–Ω—Ç—É–∏—Ü–∏—è –æ—á–µ–Ω—å –∑–∞–º–µ—Ç–Ω—ã –æ–∫—Ä—É–∂–∞—é—â–∏–º.',
        highlight: { tag: 'advice', text: '–£—á–∏—Ç–µ—Å—å —É–ø—Ä–∞–≤–ª—è—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ —Ä–µ–∞–∫—Ü–∏—è–º–∏ –≤ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö.' }
      },
      4: { 
        description: '–õ—É–Ω–∞ –≤ 4 –¥–æ–º–µ: –î–æ–º –∏ —Å–µ–º—å—è - –≤–∞—à–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–ø–æ—Ä–∞.',
        highlight: { tag: 'strength', text: '–í–∞—à–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —É—é—Ç –ø–æ–º–æ–≥–∞–µ—Ç –¥—Ä—É–≥–∏–º —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.' }
      },
      7: { 
        description: '–õ—É–Ω–∞ –≤ 7 –¥–æ–º–µ: –í—ã —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –Ω—É–∂–¥–∞–µ—Ç–µ—Å—å –≤ –±–ª–∏–∑–∫–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö.',
        highlight: { tag: 'advice', text: '–í—ã–±–∏—Ä–∞–π—Ç–µ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–Ω–∏–º–∞—é—Ç –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –≤–∞—à—É —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.' }
      },
      10: { 
        description: '–õ—É–Ω–∞ –≤ 10 –¥–æ–º–µ: –í–∞—à–∞ –∫–∞—Ä—å–µ—Ä–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –∑–∞–±–æ—Ç–æ–π –æ –¥—Ä—É–≥–∏—Ö –∏–ª–∏ –ø—É–±–ª–∏—á–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é.',
        highlight: { tag: 'strength', text: '–í–∞—à–∞ —ç–º–ø–∞—Ç–∏—è –¥–µ–ª–∞–µ—Ç –≤–∞—Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –≤ —Ä–∞–±–æ—Ç–µ —Å –ª—é–¥—å–º–∏.' }
      }
    }
  };

  return placements[planet]?.[house] || { description: `${planet} –≤ ${house} –¥–æ–º–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —ç—Ç—É —Å—Ñ–µ—Ä—É –∂–∏–∑–Ω–∏.` };
}

function getHouseAnalysis(house: number, planetCount: number, planets: ChartData['planets']) {
  const houseMeanings: Record<number, {
    title: string;
    description: string;
    strength?: string;
    advice?: string;
  }> = {
    1: {
      title: `${planetCount} –ø–ª–∞–Ω–µ—Ç –≤ 1 –¥–æ–º–µ - –°–∏–ª—å–Ω–∞—è –ª–∏—á–Ω–æ—Å—Ç—å`,
      description: '–í—ã –æ—á–µ–Ω—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã –∏ —Ö–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω—ã. –õ–∏—á–Ω–æ—Å—Ç—å, –≤–Ω–µ—à–Ω–æ—Å—Ç—å –∏ —Å–∞–º–æ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –∏–≥—Ä–∞—é—Ç –≤–∞–∂–Ω—É—é —Ä–æ–ª—å.',
      strength: '–í–∞—à–∞ —è—Ä–∫–∞—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.',
      advice: planetCount > 3 ? '–ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ —É—á–∏—Ç—ã–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—ã –¥—Ä—É–≥–∏—Ö –ª—é–¥–µ–π.' : undefined
    },
    2: {
      title: `${planetCount} –ø–ª–∞–Ω–µ—Ç –≤–æ 2 –¥–æ–º–µ - –§–æ–∫—É—Å –Ω–∞ —Ä–µ—Å—É—Ä—Å–∞—Ö`,
      description: '–î–µ–Ω—å–≥–∏, —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ—á–µ–Ω—å –≤–∞–∂–Ω—ã –¥–ª—è –≤–∞—Å.',
      strength: '–£ –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∏—Ä–æ–¥–Ω—ã–π —Ç–∞–ª–∞–Ω—Ç –∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—é –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ä–µ—Å—É—Ä—Å–∞–º–∏.',
      advice: '–ü–æ–º–Ω–∏—Ç–µ, —á—Ç–æ –Ω–µ –≤—Å–µ –≤ –∂–∏–∑–Ω–∏ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è –¥–µ–Ω—å–≥–∞–º–∏.'
    },
    3: {
      title: `${planetCount} –ø–ª–∞–Ω–µ—Ç –≤ 3 –¥–æ–º–µ - –ê–∫—Ç–∏–≤–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ`,
      description: '–û–±—â–µ–Ω–∏–µ, –æ–±—É—á–µ–Ω–∏–µ –∏ —Å–≤—è–∑–∏ —Å –±–ª–∏–∑–∫–∏–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º –∏–≥—Ä–∞—é—Ç –±–æ–ª—å—à—É—é —Ä–æ–ª—å –≤ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏.',
      strength: '–í–∞—à–∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ –ø–æ–º–æ–≥–∞—é—Ç –Ω–∞–ª–∞–∂–∏–≤–∞—Ç—å –ø–æ–ª–µ–∑–Ω—ã–µ —Å–≤—è–∑–∏.',
      advice: '–ò–Ω–æ–≥–¥–∞ –ª—É—á—à–µ –º–µ–Ω—å—à–µ –≥–æ–≤–æ—Ä–∏—Ç—å –∏ –±–æ–ª—å—à–µ —Å–ª—É—à–∞—Ç—å.'
    },
    4: {
      title: `${planetCount} –ø–ª–∞–Ω–µ—Ç –≤ 4 –¥–æ–º–µ - –í–∞–∂–Ω–æ—Å—Ç—å –¥–æ–º–∞ –∏ —Å–µ–º—å–∏`,
      description: '–°–µ–º—å—è, –¥–æ–º –∏ –∫–æ—Ä–Ω–∏ - –æ—Å–Ω–æ–≤–∞ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏. –í—ã —Ü–µ–Ω–∏—Ç–µ —Ç—Ä–∞–¥–∏—Ü–∏–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å.',
      strength: '–í–∞—à–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —É—é—Ç–Ω—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É —Ü–µ–Ω–∏—Ç—Å—è –±–ª–∏–∑–∫–∏–º–∏.',
      advice: '–ù–µ –±–æ–π—Ç–µ—Å—å –≤—ã—Ö–æ–¥–∏—Ç—å –∏–∑ –∑–æ–Ω—ã –∫–æ–º—Ñ–æ—Ä—Ç–∞ –¥–ª—è —Ä–æ—Å—Ç–∞.'
    },
    5: {
      title: `${planetCount} –ø–ª–∞–Ω–µ—Ç –≤ 5 –¥–æ–º–µ - –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ –∏ —Ä–∞–¥–æ—Å—Ç—å`,
      description: '–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ, –¥–µ—Ç–∏, —Ä–æ–º–∞–Ω—Ç–∏–∫–∞ –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è - –≤–∞—à–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã.',
      strength: '–í–∞—à–∞ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —É–º–µ–Ω–∏–µ —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è –∂–∏–∑–Ω–∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—Ç –¥—Ä—É–≥–∏—Ö.',
      advice: '–ë–∞–ª–∞–Ω—Å–∏—Ä—É–π—Ç–µ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è —Å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é.'
    },
    6: {
      title: `${planetCount} –ø–ª–∞–Ω–µ—Ç –≤ 6 –¥–æ–º–µ - –°–ª—É–∂–µ–Ω–∏–µ –∏ –∑–¥–æ—Ä–æ–≤—å–µ`,
      description: '–†–∞–±–æ—Ç–∞, –∑–¥–æ—Ä–æ–≤—å–µ –∏ –ø–æ–º–æ—â—å –¥—Ä—É–≥–∏–º –∑–∞–Ω–∏–º–∞—é—Ç —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –≤ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏.',
      strength: '–í–∞—à–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–ª—É–∂–∏—Ç—å –¥—Ä—É–≥–∏–º –¥–µ–ª–∞–µ—Ç –º–∏—Ä –ª—É—á—à–µ.',
      advice: '–ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è—Ö.'
    },
    7: {
      title: `${planetCount} –ø–ª–∞–Ω–µ—Ç –≤ 7 –¥–æ–º–µ - –û—Ç–Ω–æ—à–µ–Ω–∏—è –ø—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ`,
      description: '–ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ, –±—Ä–∞–∫ –∏ –±–ª–∏–∑–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è - –≤–∞—à–∞ –≥–ª–∞–≤–Ω–∞—è –∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Ç–µ–º–∞.',
      strength: '–í—ã —É–º–µ–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≥–∞—Ä–º–æ–Ω–∏—á–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã.',
      advice: '–†–∞–∑–≤–∏–≤–∞–π—Ç–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, —á—Ç–æ–±—ã –±—ã—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º.'
    },
    8: {
      title: `${planetCount} –ø–ª–∞–Ω–µ—Ç –≤ 8 –¥–æ–º–µ - –ì–ª—É–±–æ–∫–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏`,
      description: '–í–∞—Å –ø—Ä–∏–≤–ª–µ–∫–∞—é—Ç –≥–ª—É–±–æ–∫–∏–µ —Ç–µ–º—ã: –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è, –æ–±—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã.',
      strength: '–í–∞—à–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ –≥–ª—É–±–æ–∫–æ–º—É –ø–æ–Ω–∏–º–∞–Ω–∏—é –ø–æ–º–æ–≥–∞–µ—Ç –≤ –∫—Ä–∏–∑–∏—Å–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö.',
      advice: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ—é –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ.'
    },
    9: {
      title: `${planetCount} –ø–ª–∞–Ω–µ—Ç –≤ 9 –¥–æ–º–µ - –°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –∑–Ω–∞–Ω–∏—è–º`,
      description: '–§–∏–ª–æ—Å–æ—Ñ–∏—è, –≤—ã—Å—à–µ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –¥—É—Ö–æ–≤–Ω—ã–µ –ø–æ–∏—Å–∫–∏ –≤–∞–∂–Ω—ã –¥–ª—è –≤–∞—Å.',
      strength: '–í–∞—à —à–∏—Ä–æ–∫–∏–π –∫—Ä—É–≥–æ–∑–æ—Ä –∏ –º—É–¥—Ä–æ—Å—Ç—å –ø–æ–º–æ–≥–∞—é—Ç –≤–∏–¥–µ—Ç—å –±–æ–ª—å—à—É—é –∫–∞—Ä—Ç–∏–Ω—É.',
      advice: '–ù–µ —Ç–µ—Ä—è–π—Ç–µ—Å—å –≤ —Ç–µ–æ—Ä–∏—è—Ö - –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ –∑–Ω–∞–Ω–∏—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ.'
    },
    10: {
      title: `${planetCount} –ø–ª–∞–Ω–µ—Ç –≤ 10 –¥–æ–º–µ - –ö–∞—Ä—å–µ—Ä–Ω—ã–µ –∞–º–±–∏—Ü–∏–∏`,
      description: '–ö–∞—Ä—å–µ—Ä–∞, —Å—Ç–∞—Ç—É—Å –∏ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ - –≤–∞—à–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã.',
      strength: '–£ –≤–∞—Å –µ—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è –∑–Ω–∞—á–∏–º—ã—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π.',
      advice: '–ü–æ–º–Ω–∏—Ç–µ –æ –±–∞–ª–∞–Ω—Å–µ –º–µ–∂–¥—É –∫–∞—Ä—å–µ—Ä–æ–π –∏ –ª–∏—á–Ω–æ–π –∂–∏–∑–Ω—å—é.'
    },
    11: {
      title: `${planetCount} –ø–ª–∞–Ω–µ—Ç –≤ 11 –¥–æ–º–µ - –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –∏–¥–µ–∞–ª—ã`,
      description: '–î—Ä—É–∂–±–∞, —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã –∏ –±—É–¥—É—â–∏–µ —Ü–µ–ª–∏ –∏–≥—Ä–∞—é—Ç –≤–∞–∂–Ω—É—é —Ä–æ–ª—å.',
      strength: '–í–∞—à–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –ª—é–¥–µ–π –≤–æ–∫—Ä—É–≥ –æ–±—â–∏—Ö –∏–¥–µ–π —Ü–µ–Ω–Ω–∞ –¥–ª—è –æ–±—â–µ—Å—Ç–≤–∞.',
      advice: '–í—ã–±–∏—Ä–∞–π—Ç–µ –¥—Ä—É–∑–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –≤–∞—à —Ä–æ—Å—Ç.'
    },
    12: {
      title: `${planetCount} –ø–ª–∞–Ω–µ—Ç –≤ 12 –¥–æ–º–µ - –î—É—Ö–æ–≤–Ω—ã–µ –ø–æ–∏—Å–∫–∏`,
      description: '–ü–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ, –¥—É—Ö–æ–≤–Ω–æ—Å—Ç—å –∏ —Å–ª—É–∂–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤—É - –≤–∞—à–∏ –≥–ª—É–±–æ–∫–∏–µ —Ç–µ–º—ã.',
      strength: '–í–∞—à–∞ –∏–Ω—Ç—É–∏—Ü–∏—è –∏ —Å–æ—á—É–≤—Å—Ç–≤–∏–µ –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–Ω–∏–º–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –º–æ—Ç–∏–≤—ã –ª—é–¥–µ–π.',
      advice: '–ù–∞–π–¥–∏—Ç–µ –∑–¥–æ—Ä–æ–≤—ã–µ —Å–ø–æ—Å–æ–±—ã –≤—ã—Ä–∞–∂–µ–Ω–∏—è —Å–≤–æ–µ–π —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.'
    }
  };

  return houseMeanings[house] || {
    title: `${planetCount} –ø–ª–∞–Ω–µ—Ç –≤ ${house} –¥–æ–º–µ`,
    description: '–≠—Ç–∞ —Å—Ñ–µ—Ä–∞ –∂–∏–∑–Ω–∏ —Ç—Ä–µ–±—É–µ—Ç –æ—Å–æ–±–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è.'
  };
}

function analyzeDistribution(houseCounts: Record<number, number>) {
  const totalPlanets = Object.values(houseCounts).reduce((sum, count) => sum + count, 0);
  
  if (totalPlanets === 0) return null;

  // –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–µ—Ç
  const occupiedHouses = Object.values(houseCounts).filter(count => count > 0).length;
  
  if (occupiedHouses <= 4) {
    return {
      description: '–£ –≤–∞—Å –æ—á–µ–Ω—å —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞ - –≤—ã –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç–µ—Å—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–ª—é—á–µ–≤—ã—Ö –æ–±–ª–∞—Å—Ç—è—Ö.',
      highlight: {
        tag: 'strength' as const,
        text: '–í–∞—à–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ –≥–ª—É–±–æ–∫–æ–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ—Å—Ç–∏–≥–∞—Ç—å –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞ –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ–±–ª–∞—Å—Ç—è—Ö.'
      }
    };
  }
  
  if (occupiedHouses >= 10) {
    return {
      description: '–í–∞—à–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –æ—á–µ–Ω—å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã - –≤—ã –∞–∫—Ç–∏–≤–Ω—ã –≤–æ –º–Ω–æ–≥–∏—Ö —Å—Ñ–µ—Ä–∞—Ö –∂–∏–∑–Ω–∏.',
      highlight: {
        tag: 'advice' as const,
        text: '–°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –Ω–µ —Ä–∞—Å–ø—ã–ª—è—Ç—å—Å—è - –≤—ã–±–µ—Ä–∏—Ç–µ 2-3 –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è.'
      }
    };
  }

  // –ê–Ω–∞–ª–∏–∑ –ø–æ–ª—É—Å—Ñ–µ—Ä
  const upperHouses = [7, 8, 9, 10, 11, 12].reduce((sum, house) => sum + houseCounts[house], 0);
  const lowerHouses = [1, 2, 3, 4, 5, 6].reduce((sum, house) => sum + houseCounts[house], 0);
  
  if (upperHouses > lowerHouses * 2) {
    return {
      description: '–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–ª–∞–Ω–µ—Ç –≤ –≤–µ—Ä—Ö–Ω–µ–π –ø–æ–ª—É—Å—Ñ–µ—Ä–µ - –≤—ã –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –≤–Ω–µ—à–Ω–∏–π –º–∏—Ä –∏ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—É—é –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å.',
      highlight: {
        tag: 'advice' as const,
        text: '–ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ –ª–∏—á–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è—Ö –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º —Ä–∞–∑–≤–∏—Ç–∏–∏.'
      }
    };
  }
  
  if (lowerHouses > upperHouses * 2) {
    return {
      description: '–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–ª–∞–Ω–µ—Ç –≤ –Ω–∏–∂–Ω–µ–π –ø–æ–ª—É—Å—Ñ–µ—Ä–µ - –≤—ã —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω—ã –Ω–∞ –ª–∏—á–Ω–æ–º —Ä–∞–∑–≤–∏—Ç–∏–∏ –∏ –±–ª–∏–∑–∫–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö.',
      highlight: {
        tag: 'advice' as const,
        text: '–†–∞–∑–≤–∏–≤–∞–π—Ç–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ –∏ –Ω–µ –±–æ–π—Ç–µ—Å—å –∑–∞—è–≤–ª—è—Ç—å –æ —Å–µ–±–µ –ø—É–±–ª–∏—á–Ω–æ.'
      }
    };
  }

  return null;
}

function getHouseIcon(house: number): string {
  const icons = ['üåü', 'üí∞', 'üó£Ô∏è', 'üè†', 'üé®', '‚öïÔ∏è', 'üíï', 'üîÑ', 'üéì', 'üèÜ', 'üë•', 'üßò'];
  return icons[house - 1] || '‚≠ê';
}