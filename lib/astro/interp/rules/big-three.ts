// –ê–Ω–∞–ª–∏–∑ Big-3: –°–æ–ª–Ω—Ü–µ, –õ—É–Ω–∞, –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç
// –û—Å–Ω–æ–≤–∞ –ª–∏—á–Ω–æ—Å—Ç–∏ –±–µ–∑ –º–∏—Å—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

import type { ChartData } from '../../types';

export function analyzeBigThree(chartData: ChartData) {
  const items: string[] = [];
  const highlights: Array<{ tag: 'strength' | 'risk' | 'advice'; text: string }> = [];

  const sun = chartData.planets.find(p => p.name === 'Sun');
  const moon = chartData.planets.find(p => p.name === 'Moon');
  const sunSign = chartData.sunSign;
  const moonSign = chartData.moonSign;
  const risingSign = chartData.risingSign;

  // –ê–Ω–∞–ª–∏–∑ –°–æ–ª–Ω—Ü–∞ (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–∏—á–Ω–æ—Å—Ç—å)
  const sunAnalysis = getSunAnalysis(sunSign, sun?.house);
  items.push(`‚òâ –°–æ–ª–Ω—Ü–µ –≤ ${sunSign}: ${sunAnalysis.trait}`);
  if (sunAnalysis.strength) {
    highlights.push({ tag: 'strength', text: sunAnalysis.strength });
  }

  // –ê–Ω–∞–ª–∏–∑ –õ—É–Ω—ã (—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–∏—Ä–æ–¥–∞)
  const moonAnalysis = getMoonAnalysis(moonSign, moon?.house);
  items.push(`‚òΩ –õ—É–Ω–∞ –≤ ${moonSign}: ${moonAnalysis.trait}`);
  if (moonAnalysis.advice) {
    highlights.push({ tag: 'advice', text: moonAnalysis.advice });
  }

  // –ê–Ω–∞–ª–∏–∑ –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç–∞ (–≤–Ω–µ—à–Ω–µ–µ –ø—Ä–æ—è–≤–ª–µ–Ω–∏–µ)
  const risingAnalysis = getRisingAnalysis(risingSign);
  items.push(`‚Üó –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç –≤ ${risingSign}: ${risingAnalysis.trait}`);

  // –°–∏–Ω–µ—Ä–≥–∏—è –º–µ–∂–¥—É –∑–Ω–∞–∫–∞–º–∏
  const synergy = analyzeSynergy(sunSign, moonSign, risingSign);
  if (synergy) {
    items.push(`üîÑ ${synergy.description}`);
    if (synergy.highlight) {
      highlights.push({ tag: synergy.highlight.tag, text: synergy.highlight.text });
    }
  }

  return {
    items,
    highlights,
    tip: '–°–æ–ª–Ω—Ü–µ - –≤–∞—à–∞ —Å—É—Ç—å, –õ—É–Ω–∞ - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–∏—Ä, –ê—Å—Ü–µ–Ω–¥–µ–Ω—Ç - –∫–∞–∫ –≤–∞—Å –≤–∏–¥—è—Ç. –í—Å–µ —Ç—Ä–∏ –≤–∞–∂–Ω—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å–µ–±—è.'
  };
}

function getSunAnalysis(sign: string, house?: number) {
  const sunTraits: Record<string, { trait: string; strength?: string }> = {
    'Aries': {
      trait: '–í—ã –ø—Ä–∏—Ä–æ–∂–¥–µ–Ω–Ω—ã–π –ª–∏–¥–µ—Ä —Å –æ–≥—Ä–æ–º–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–µ–π. –õ—é–±–∏—Ç–µ –±—ã—Ç—å –ø–µ—Ä–≤—ã–º–∏ –∏ –Ω–µ –±–æ–∏—Ç–µ—Å—å —Ä–∏—Å–∫–æ–≤–∞—Ç—å.',
      strength: '–í–∞—à–∞ —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —ç–Ω—Ç—É–∑–∏–∞–∑–º –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—Ç –æ–∫—Ä—É–∂–∞—é—â–∏—Ö.'
    },
    'Taurus': {
      trait: '–í—ã —Ü–µ–Ω–∏—Ç–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –∫—Ä–∞—Å–æ—Ç—É. –û–±–ª–∞–¥–∞–µ—Ç–µ –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º —É–º–æ–º –∏ —É–º–µ–µ—Ç–µ –Ω–∞—Å–ª–∞–∂–¥–∞—Ç—å—Å—è –∂–∏–∑–Ω—å—é.',
      strength: '–í–∞—à–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ —Ç–µ—Ä–ø–µ–Ω–∏–µ - –æ—Å–Ω–æ–≤–∞ –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ —É—Å–ø–µ—Ö–∞.'
    },
    'Gemini': {
      trait: '–í—ã –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã –∏ –æ–±—â–∏—Ç–µ–ª—å–Ω—ã. –ë—ã—Å—Ç—Ä–æ —Å—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç–µ –Ω–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç–µ—Å—å.',
      strength: '–í–∞—à–∞ –≥–∏–±–∫–æ—Å—Ç—å –º—ã—à–ª–µ–Ω–∏—è –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è.'
    },
    'Cancer': {
      trait: '–í—ã —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∏ –∑–∞–±–æ—Ç–ª–∏–≤—ã. –°–µ–º—å—è –∏ –±–ª–∏–∑–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –¥–ª—è –≤–∞—Å –æ—á–µ–Ω—å –≤–∞–∂–Ω—ã.',
      strength: '–í–∞—à–∞ –∏–Ω—Ç—É–∏—Ü–∏—è –∏ —ç–º–ø–∞—Ç–∏—è —Å–æ–∑–¥–∞—é—Ç –≥–ª—É–±–æ–∫–∏–µ —Å–≤—è–∑–∏ —Å –ª—é–¥—å–º–∏.'
    },
    'Leo': {
      trait: '–í—ã —è—Ä–∫–∞—è –ª–∏—á–Ω–æ—Å—Ç—å —Å —Ç–≤–æ—Ä—á–µ—Å–∫–∏–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–æ–º. –õ—é–±–∏—Ç–µ –±—ã—Ç—å –≤ —Ü–µ–Ω—Ç—Ä–µ –≤–Ω–∏–º–∞–Ω–∏—è –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å –¥—Ä—É–≥–∏—Ö.',
      strength: '–í–∞—à–∞ —Ö–∞—Ä–∏–∑–º–∞ –∏ —â–µ–¥—Ä–æ—Å—Ç—å –ø—Ä–∏—Ç—è–≥–∏–≤–∞—é—Ç –ª—é–¥–µ–π –∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.'
    },
    'Virgo': {
      trait: '–í—ã –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã –∫ –¥–µ—Ç–∞–ª—è–º –∏ —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤—É. –ü—Ä–∞–∫—Ç–∏—á–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ–≥–∞—Ç—å –¥—Ä—É–≥–∏–º.',
      strength: '–í–∞—à–∞ –∞–Ω–∞–ª–∏—Ç–∏—á–Ω–æ—Å—Ç—å –∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–µ–ª–∞—é—Ç –≤–∞—Å –Ω–µ–∑–∞–º–µ–Ω–∏–º—ã–º–∏ –≤ –ª—é–±–æ–π –∫–æ–º–∞–Ω–¥–µ.'
    },
    'Libra': {
      trait: '–í—ã —Å—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –≥–∞—Ä–º–æ–Ω–∏–∏ –∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏. –û–±–ª–∞–¥–∞–µ—Ç–µ —Ö–æ—Ä–æ—à–∏–º –≤–∫—É—Å–æ–º –∏ –¥–∏–ø–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è–º–∏.',
      strength: '–í–∞—à–µ —É–º–µ–Ω–∏–µ –Ω–∞—Ö–æ–¥–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–º–æ–≥–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫—Ä–∞—Å–æ—Ç—É.'
    },
    'Scorpio': {
      trait: '–í—ã –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã –∏ –ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω—ã. –ù–µ –±–æ–∏—Ç–µ—Å—å –≥–ª—É–±–∏–Ω—ã –∏ —Å–ø–æ—Å–æ–±–Ω—ã –∫ –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º.',
      strength: '–í–∞—à–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–µ–æ–¥–æ–ª–µ–≤–∞—Ç—å –ª—é–±—ã–µ –∫—Ä–∏–∑–∏—Å—ã.'
    },
    'Sagittarius': {
      trait: '–í—ã –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã –∏ —Å–≤–æ–±–æ–¥–æ–ª—é–±–∏–≤—ã. –°—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –∑–Ω–∞–Ω–∏—è–º, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è–º –∏ –Ω–æ–≤—ã–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–º.',
      strength: '–í–∞—à —ç–Ω—Ç—É–∑–∏–∞–∑–º –∏ —à–∏—Ä–æ–∫–∏–π –≤–∑–≥–ª—è–¥ –Ω–∞ –º–∏—Ä –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.'
    },
    'Capricorn': {
      trait: '–í—ã –∞–º–±–∏—Ü–∏–æ–∑–Ω—ã –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∏—Ä–æ–≤–∞–Ω—ã. –£–º–µ–µ—Ç–µ —Å—Ç–∞–≤–∏—Ç—å –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ü–µ–ª–∏ –∏ –¥–æ—Å—Ç–∏–≥–∞—Ç—å –∏—Ö.',
      strength: '–í–∞—à–∞ —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ—Å—Ç—å –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å - –∫–ª—é—á–∏ –∫ —Å–µ—Ä—å–µ–∑–Ω—ã–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º.'
    },
    'Aquarius': {
      trait: '–í—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã –∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã. –î—É–º–∞–µ—Ç–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ –∏ –∑–∞–±–æ—Ç–∏—Ç–µ—Å—å –æ –±—É–¥—É—â–µ–º —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞.',
      strength: '–í–∞—à–∞ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –≥—É–º–∞–Ω–Ω–æ—Å—Ç—å –ø–æ–º–æ–≥–∞—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è.'
    },
    'Pisces': {
      trait: '–í—ã —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∏ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã. –û–±–ª–∞–¥–∞–µ—Ç–µ –±–æ–≥–∞—Ç—ã–º –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∏ —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ–º –∫ –¥—Ä—É–≥–∏–º.',
      strength: '–í–∞—à–∞ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —ç–º–ø–∞—Ç–∏—è –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–Ω–∞—á–∏–º–æ–µ.'
    }
  };

  const analysis = sunTraits[sign] || { trait: '–£ –≤–∞—Å —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –ª–∏—á–Ω–æ—Å—Ç—å —Å –æ—Å–æ–±—ã–º–∏ –∫–∞—á–µ—Å—Ç–≤–∞–º–∏.' };
  
  // –î–æ–±–∞–≤–ª—è–µ–º –≤–ª–∏—è–Ω–∏–µ –¥–æ–º–∞ –µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω–æ
  if (house && house >= 1 && house <= 12) {
    const houseInfluences = [
      '—á—Ç–æ –¥–µ–ª–∞–µ—Ç –≤–∞—Å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –ª–∏–¥–µ—Ä–æ–º',
      '—á—Ç–æ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –≤–∞—à–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ —Ä–µ—Å—É—Ä—Å–∞–º',
      '—á—Ç–æ –≤—ã—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –æ–±—â–µ–Ω–∏–∏ –∏ –æ–±—É—á–µ–Ω–∏–∏',
      '—á—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –¥–æ–º–æ–º –∏ —Å–µ–º—å–µ–π',
      '—á—Ç–æ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ',
      '—á—Ç–æ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Ä–∞–±–æ—Ç–µ –∏ –∑–∞–±–æ—Ç–µ –æ –∑–¥–æ—Ä–æ–≤—å–µ',
      '—á—Ç–æ –≤—ã—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏',
      '—á—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –≥–ª—É–±–æ–∫–∏–º–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è–º–∏',
      '—á—Ç–æ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –∑–Ω–∞–Ω–∏—è–º',
      '—á—Ç–æ –≤—ã—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∫–∞—Ä—å–µ—Ä–µ –∏ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–º –ø—Ä–∏–∑–Ω–∞–Ω–∏–∏',
      '—á—Ç–æ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –¥—Ä—É–∂–±–µ –∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –∏–¥–µ–∞–ª–∞—Ö',
      '—á—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –¥—É—Ö–æ–≤–Ω—ã–º —Ä–∞–∑–≤–∏—Ç–∏–µ–º'
    ];
    
    analysis.trait += `, ${houseInfluences[house - 1]}`;
  }

  return analysis;
}

function getMoonAnalysis(sign: string, house?: number) {
  const moonTraits: Record<string, { trait: string; advice?: string }> = {
    'Aries': {
      trait: '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤—ã –∏–º–ø—É–ª—å—Å–∏–≤–Ω—ã –∏ –ø—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω—ã. –ù—É–∂–¥–∞–µ—Ç–µ—Å—å –≤ –¥–µ–π—Å—Ç–≤–∏–∏ –∏ –Ω–æ–≤—ã—Ö –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è—Ö.',
      advice: '–ù–∞–π–¥–∏—Ç–µ –∑–¥–æ—Ä–æ–≤—ã–µ —Å–ø–æ—Å–æ–±—ã –≤—ã–ø–ª–µ—Å–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏ - —Å–ø–æ—Ä—Ç, –∞–∫—Ç–∏–≤–Ω—ã–µ —Ö–æ–±–±–∏.'
    },
    'Taurus': {
      trait: '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤–∞–º –Ω—É–∂–Ω—ã —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –∫–æ–º—Ñ–æ—Ä—Ç. –¶–µ–Ω–∏—Ç–µ –ø—Ä–æ—Å—Ç—ã–µ —Ä–∞–¥–æ—Å—Ç–∏ –∂–∏–∑–Ω–∏.',
      advice: '–°–æ–∑–¥–∞–π—Ç–µ —É—é—Ç–Ω—É—é –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –¥–æ–º–∞ - —ç—Ç–æ –≤–∞—à–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–∑–∞—Ä—è–¥–∫–∞.'
    },
    'Gemini': {
      trait: '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤—ã –Ω—É–∂–¥–∞–µ—Ç–µ—Å—å –≤ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–∏ –∏ –æ–±—â–µ–Ω–∏–∏. –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ –º–µ–Ω—è—Ç—å—Å—è.',
      advice: '–í–µ–¥–∏—Ç–µ –¥–Ω–µ–≤–Ω–∏–∫ –∏–ª–∏ –Ω–∞–π–¥–∏—Ç–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ - –≤–∞–º –≤–∞–∂–Ω–æ –≤—ã—Ä–∞–∂–∞—Ç—å –º—ã—Å–ª–∏ –∏ —á—É–≤—Å—Ç–≤–∞.'
    },
    'Cancer': {
      trait: '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤—ã –æ—á–µ–Ω—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∏ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã. –°–µ–º—å—è –∏ –¥–æ–º - –≤–∞—à–∞ –æ–ø–æ—Ä–∞.',
      advice: '–î–æ–≤–µ—Ä—è–π—Ç–µ —Å–≤–æ–µ–π –∏–Ω—Ç—É–∏—Ü–∏–∏ –∏ –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –ø—Ä–æ—è–≤–ª—è—Ç—å –∑–∞–±–æ—Ç—É –æ –±–ª–∏–∑–∫–∏—Ö.'
    },
    'Leo': {
      trait: '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤–∞–º –Ω—É–∂–Ω—ã –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ç–≤–æ—Ä—á–µ—Å–∫–æ–≥–æ —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏—è.',
      advice: '–ù–∞–π–¥–∏—Ç–µ —Å–ø–æ—Å–æ–±—ã –ø—Ä–æ—è–≤–∏—Ç—å —Å–≤–æ—é —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å - —ç—Ç–æ –ø–∏—Ç–∞–µ—Ç –≤–∞—à—É –¥—É—à—É.'
    },
    'Virgo': {
      trait: '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤—ã –Ω—É–∂–¥–∞–µ—Ç–µ—Å—å –≤ –ø–æ—Ä—è–¥–∫–µ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º–∏.',
      advice: '–ü–æ–º–æ—â—å –¥—Ä—É–≥–∏–º –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º –¥–∞—é—Ç –≤–∞–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ.'
    },
    'Libra': {
      trait: '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤–∞–º –Ω—É–∂–Ω—ã –≥–∞—Ä–º–æ–Ω–∏—è –∏ –∫—Ä–∞—Å–æ—Ç–∞. –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å–∏–ª—å–Ω–æ –≤—ã–±–∏–≤–∞—é—Ç –∏–∑ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è.',
      advice: '–û–∫—Ä—É–∂–∏—Ç–µ —Å–µ–±—è –∫—Ä–∞—Å–æ—Ç–æ–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–º–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏.'
    },
    'Scorpio': {
      trait: '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤—ã –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã –∏ –≥–ª—É–±–æ–∫–∏. –ù—É–∂–¥–∞–µ—Ç–µ—Å—å –≤ –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏.',
      advice: '–ù–µ –±–æ–π—Ç–µ—Å—å —Å–≤–æ–∏—Ö –≥–ª—É–±–æ–∫–∏—Ö —á—É–≤—Å—Ç–≤ - –æ–Ω–∏ –≤–∞—à–∞ —Å–∏–ª–∞ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –º—É–¥—Ä–æ—Å—Ç–∏.'
    },
    'Sagittarius': {
      trait: '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤–∞–º –Ω—É–∂–Ω—ã —Å–≤–æ–±–æ–¥–∞ –∏ –Ω–æ–≤—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã. –û–ø—Ç–∏–º–∏–∑–º - –≤–∞—à–∞ –∑–∞—â–∏—Ç–∞.',
      advice: '–ü—É—Ç–µ—à–µ—Å—Ç–≤—É–π—Ç–µ, –∏–∑—É—á–∞–π—Ç–µ –Ω–æ–≤–æ–µ - —ç—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∞—à —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å.'
    },
    'Capricorn': {
      trait: '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤—ã —Å–¥–µ—Ä–∂–∞–Ω–Ω—ã, –Ω–æ –Ω—É–∂–¥–∞–µ—Ç–µ—Å—å –≤ —É–≤–∞–∂–µ–Ω–∏–∏ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è—Ö.',
      advice: '–ü–æ–∑–≤–æ–ª—è–π—Ç–µ —Å–µ–±–µ –≥–æ—Ä–¥–∏—Ç—å—Å—è —Å–≤–æ–∏–º–∏ —É—Å–ø–µ—Ö–∞–º–∏ –∏ –Ω–µ –±–æ–π—Ç–µ—Å—å –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç—å.'
    },
    'Aquarius': {
      trait: '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤–∞–º –Ω—É–∂–Ω—ã —Å–≤–æ–±–æ–¥–∞ –∏ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–∏. –¶–µ–Ω–∏—Ç–µ –¥—Ä—É–∂–±—É –≤—ã—à–µ —Ä–æ–º–∞–Ω—Ç–∏–∫–∏.',
      advice: '–ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –ª—é–¥–µ–π —Å–æ —Å—Ö–æ–∂–∏–º–∏ –∏–¥–µ–∞–ª–∞–º–∏ –∏ —Ü–µ–Ω–Ω–æ—Å—Ç—è–º–∏.'
    },
    'Pisces': {
      trait: '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤—ã –æ—á–µ–Ω—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∏ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã. –ù—É–∂–¥–∞–µ—Ç–µ—Å—å –≤ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–µ –∏ –¥—É—Ö–æ–≤–Ω–æ—Å—Ç–∏.',
      advice: '–†–∞–∑–≤–∏–≤–∞–π—Ç–µ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–π–¥–∏—Ç–µ –≤—Ä–µ–º—è –¥–ª—è —É–µ–¥–∏–Ω–µ–Ω–∏—è –∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏.'
    }
  };

  return moonTraits[sign] || { trait: '–£ –≤–∞—Å –æ—Å–æ–±—ã–π —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å.' };
}

function getRisingAnalysis(sign: string) {
  const risingTraits: Record<string, { trait: string }> = {
    'Aries': { trait: '–û–∫—Ä—É–∂–∞—é—â–∏–µ –≤–∏–¥—è—Ç –≤–∞—Å –∫–∞–∫ —ç–Ω–µ—Ä–≥–∏—á–Ω–æ–≥–æ –∏ —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞' },
    'Taurus': { trait: '–í—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –∏ —Å–ø–æ–∫–æ–π–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞' },
    'Gemini': { trait: '–õ—é–¥–∏ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç –≤–∞—Å –∫–∞–∫ –æ–±—â–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏ –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–≥–æ' },
    'Cancer': { trait: '–í—ã –∫–∞–∂–µ—Ç–µ—Å—å –∑–∞–±–æ—Ç–ª–∏–≤—ã–º –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –æ—Ç–∑—ã–≤—á–∏–≤—ã–º' },
    'Leo': { trait: '–û–∫—Ä—É–∂–∞—é—â–∏–µ –≤–∏–¥—è—Ç –≤ –≤–∞—Å —è—Ä–∫—É—é –∏ —Ö–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω—É—é –ª–∏—á–Ω–æ—Å—Ç—å' },
    'Virgo': { trait: '–í—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∫ –¥–µ—Ç–∞–ª—è–º' },
    'Libra': { trait: '–õ—é–¥–∏ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç –≤–∞—Å –∫–∞–∫ –¥–∏–ø–ª–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∏ –æ–±–∞—è—Ç–µ–ª—å–Ω–æ–≥–æ' },
    'Scorpio': { trait: '–í—ã –∫–∞–∂–µ—Ç–µ—Å—å –∑–∞–≥–∞–¥–æ—á–Ω—ã–º –∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–º' },
    'Sagittarius': { trait: '–û–∫—Ä—É–∂–∞—é—â–∏–µ –≤–∏–¥—è—Ç –≤–∞—Å –∫–∞–∫ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–≥–æ –∏ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –º–∏—Ä—É' },
    'Capricorn': { trait: '–í—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ —Å–µ—Ä—å–µ–∑–Ω–æ–≥–æ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞' },
    'Aquarius': { trait: '–õ—é–¥–∏ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç –≤–∞—Å –∫–∞–∫ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–≥–æ –∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ' },
    'Pisces': { trait: '–í—ã –∫–∞–∂–µ—Ç–µ—Å—å –º–µ—á—Ç–∞—Ç–µ–ª—å–Ω—ã–º –∏ —Å–æ—á—É–≤—Å—Ç–≤—É—é—â–∏–º' }
  };

  return risingTraits[sign] || { trait: '–£ –≤–∞—Å —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –º–∞–Ω–µ—Ä–∞ —Å–∞–º–æ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏' };
}

function analyzeSynergy(sun: string, moon: string, rising: string) {
  // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç–æ–≤
  const elements = {
    'Aries': 'fire', 'Leo': 'fire', 'Sagittarius': 'fire',
    'Taurus': 'earth', 'Virgo': 'earth', 'Capricorn': 'earth',
    'Gemini': 'air', 'Libra': 'air', 'Aquarius': 'air',
    'Cancer': 'water', 'Scorpio': 'water', 'Pisces': 'water'
  };

  const sunElement = elements[sun as keyof typeof elements];
  const moonElement = elements[moon as keyof typeof elements];
  const risingElement = elements[rising as keyof typeof elements];

  // –ï—Å–ª–∏ –≤—Å–µ —Ç—Ä–∏ –≤ –æ–¥–Ω–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
  if (sunElement === moonElement && moonElement === risingElement) {
    const elementDescriptions = {
      fire: '–í—ã –æ—á–µ–Ω—å —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–π –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π —á–µ–ª–æ–≤–µ–∫, –Ω–æ –≤–∞–∂–Ω–æ –Ω–µ –≤—ã–≥–æ—Ä–∞—Ç—å.',
      earth: '–í—ã –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∞–∫—Ç–∏—á–Ω—ã –∏ –Ω–∞–¥–µ–∂–Ω—ã, –Ω–æ –Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –º–µ—á—Ç–∞—Ç—å.',
      air: '–í—ã –∂–∏–≤–µ—Ç–µ –∏–¥–µ—è–º–∏ –∏ –æ–±—â–µ–Ω–∏–µ–º, –Ω–æ –≤–∞–∂–Ω–æ –Ω–µ —Ç–µ—Ä—è—Ç—å —Å–≤—è–∑—å —Å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é.',
      water: '–í—ã –æ—á–µ–Ω—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∏ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã, –Ω–æ –Ω—É–∂–Ω—ã –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –∑–∞—â–∏—Ç—ã.'
    };

    return {
      description: elementDescriptions[sunElement as keyof typeof elementDescriptions],
      highlight: {
        tag: 'advice' as const,
        text: `–í—Å–µ –≤–∞—à–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–µ—Ä–≥–∏–∏ –≤ —ç–ª–µ–º–µ–Ω—Ç–µ ${getElementName(sunElement)} - —ç—Ç–æ –¥–∞–µ—Ç —Å–∏–ª—É, –Ω–æ –≤–∞–∂–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–∞ –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤.`
      }
    };
  }

  // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É –°–æ–ª–Ω—Ü–µ–º –∏ –õ—É–Ω–æ–π
  const conflictingPairs = [
    ['fire', 'water'], ['earth', 'air']
  ];

  const hasConflict = conflictingPairs.some(([elem1, elem2]) => 
    (sunElement === elem1 && moonElement === elem2) || 
    (sunElement === elem2 && moonElement === elem1)
  );

  if (hasConflict) {
    return {
      description: '–í–∞—à–∏ –≤–Ω–µ—à–Ω–∏–µ —Ü–µ–ª–∏ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –∏–Ω–æ–≥–¥–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.',
      highlight: {
        tag: 'advice' as const,
        text: '–ù–∞—É—á–∏—Ç–µ—Å—å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã —Å–≤–æ–µ–π –Ω–∞—Ç—É—Ä—ã - –≤ —ç—Ç–æ–º –≤–∞—à–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å.'
      }
    };
  }

  return null;
}

function getElementName(element: string): string {
  const names = {
    fire: '–û–≥–Ω—è',
    earth: '–ó–µ–º–ª–∏', 
    air: '–í–æ–∑–¥—É—Ö–∞',
    water: '–í–æ–¥—ã'
  };
  return names[element as keyof typeof names] || element;
}